{% extends "base.html" %}

{% block title %}All Landsat Tiles{% endblock %}

{% block extra_css %}
<style>
.table-container { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.table thead th { background: #f8f9fa; font-weight: 600; }
.status-badge { padding: 4px 10px; border-radius: 16px; font-size: 0.8rem; }
.badge-pending { background: #fff3cd; color: #856404; }
.badge-processing { background: #d1ecf1; color: #0c5460; }
.badge-completed { background: #d4edda; color: #155724; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <h2 class="mb-3"><i class="bi bi-grid-3x3-gap"></i> All Landsat Tiles</h2>
  <p class="text-muted">Browse and filter the full tile index from the database. Click a tile to open on the map.</p>

  <form method="get" class="row g-3 mb-3">
    <div class="col-md-3">
      <label class="form-label">Search (tile/path/row)</label>
      <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="p104r070 or 104 or 070" />
    </div>
    <div class="col-md-3">
      <label class="form-label">Status</label>
      <select name="status" class="form-select">
        <option value="">All</option>
        <option value="pending" {% if status == "pending" %}selected{% endif %}>Pending</option>
        <option value="processing" {% if status == "processing" %}selected{% endif %}>Processing</option>
        <option value="completed" {% if status == "completed" %}selected{% endif %}>Completed</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Active</label>
      <select name="active" class="form-select">
        <option value="">All</option>
        <option value="true" {% if active == "true" %}selected{% endif %}>Active</option>
        <option value="false" {% if active == "false" %}selected{% endif %}>Inactive</option>
      </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
      <button type="submit" class="btn btn-primary me-2"><i class="bi bi-filter"></i> Apply</button>
      <a href="/tiles/all/" class="btn btn-outline-secondary"><i class="bi bi-arrow-clockwise"></i> Reset</a>
    </div>
  </form>

  <div class="table-container">
    <table class="table table-striped table-hover align-middle">
      <thead>
        <tr>
          <th scope="col">Tile ID</th>
          <th scope="col">Path</th>
          <th scope="col">Row</th>
          <th scope="col">Status</th>
          <th scope="col">Active</th>
          <th scope="col" class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for t in tiles %}
        <tr>
          <td><code>{{ t.tile_id }}</code></td>
          <td>{{ t.path }}</td>
          <td>{{ t.row }}</td>
          <td>
            {% if t.status == "processing" %}
              <span class="status-badge badge-processing">Processing</span>
            {% elif t.status == "completed" %}
              <span class="status-badge badge-completed">Completed</span>
            {% else %}
              <span class="status-badge badge-pending">Pending</span>
            {% endif %}
          </td>
          <td>
            {% if t.is_active %}
              <span class="badge bg-success">Active</span>
            {% else %}
              <span class="badge bg-secondary">Inactive</span>
            {% endif %}
          </td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" href="/tiles/map/?tile={{ t.tile_id }}">
              <i class="bi bi-map"></i> View on Map
            </a>
            <a class="btn btn-sm btn-outline-info" href="/admin/catalog/landsattile/{{ t.id }}/change/">
              <i class="bi bi-pencil"></i> Edit
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4">
            <i class="bi bi-inbox"></i> No tiles found for current filters
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
  <nav aria-label="Pagination" class="mt-3">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&search={{ search }}&status={{ status }}&active={{ active }}">Previous</a></li>
      {% endif %}
      <li class="page-item active"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>
      {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&search={{ search }}&status={{ status }}&active={{ active }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
